<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Price Calculator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Computer Price Calculator</h1>
        <form id="priceCalcForm">
            <div class="form-group">
                <label for="kind">Processor Kind</label>
                <select class="form-control" id="kind" name="kind" required onchange="toggleProcessorOptions()">
                    <option value="intel">Intel</option>
                    <option value="amd">AMD</option>
                </select>
            </div>
            <div class="form-group">
                <label for="model">Processor Model</label>
                <input type="text" class="form-control" id="model" name="model" required>
            </div>
            <div class="form-group" id="amd-price-container" style="display: none;">
                <label for="amd_price">AMD Processor Price</label>
                <input type="number" class="form-control" id="amd_price" name="amd_price" step="0.01">
            </div>
            <div class="form-group">
                <label for="ram_size">RAM Size (GB)</label>
                <input type="number" class="form-control" id="ram_size" name="ram_size" required>
            </div>
            <div class="form-group">
                <label for="os">Operating System</label>
                <input type="text" class="form-control" id="os" name="os" required>
            </div>
            <div id="storage-container">
                <h4>Storage Devices</h4>
                <button type="button" class="btn btn-primary mb-2" onclick="addStorage()">Add Storage Device</button>
            </div>
            <div class="form-group">
                <label for="is_laptop">Is this computer a laptop?</label>
                <select class="form-control" id="is_laptop" name="is_laptop" required onchange="toggleLaptopOptions()">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div id="laptop-options" style="display: none;">
                <div class="form-group">
                    <label for="battery_capacity">Battery Capacity (%)</label>
                    <input type="number" class="form-control" id="battery_capacity" name="battery_capacity">
                </div>
                <div class="form-group">
                    <label for="has_large_screen">Has large screen (>15.6")?</label>
                    <select class="form-control" id="has_large_screen" name="has_large_screen">
                        <option value="no">No</option>
                        <option value="yes">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="has_touch_screen">Has touch screen?</label>
                    <select class="form-control" id="has_touch_screen" name="has_touch_screen">
                        <option value="no">No</option>
                        <option value="yes">Yes</option>
                    </select>
                </div>
            </div>
            <div id="desktop-options">
                <div class="form-group">
                    <label for="desktop_wifi">Does this desktop have wifi?</label>
                    <select class="form-control" id="desktop_wifi" name="desktop_wifi" onchange="toggleWifiOptions()">
                        <option value="no">No</option>
                        <option value="yes">Yes</option>
                    </select>
                </div>
                <div class="form-group" id="wifi-kind-container" style="display: none;">
                    <label for="wifi_kind">Wifi kind</label>
                    <input type="text" class="form-control" id="wifi_kind" name="wifi_kind">
                </div>
                <div class="form-group">
                    <label for="custom_build">Is this a custom-built desktop?</label>
                    <select class="form-control" id="custom_build" name="custom_build">
                        <option value="no">No</option>
                        <option value="yes">Yes</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="has_gpu">Has GPU?</label>
                <select class="form-control" id="has_gpu" name="has_gpu" required onchange="toggleGpuOptions()">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div id="gpu-options" style="display: none;">
                <div class="form-group">
                    <label for="gpu_type">GPU Type</label>
                    <select class="form-control" id="gpu_type" name="gpu_type">
                        <option value="discrete">Discrete GPU</option>
                        <option value="amd">AMD Radeon GPU</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="passmark_score">Passmark Score</label>
                    <input type="number" class="form-control" id="passmark_score" name="passmark_score">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Calculate</button>
        </form>
        <div id="result" class="mt-4"></div>
    </div>

    <script>
        document.getElementById('priceCalcForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const storage = [];

    for (let i = 0; i < formData.getAll('storage_size').length; i++) {
        storage.push({
            size: formData.getAll('storage_size')[i],
            kind: formData.getAll('storage_kind')[i]
        });
    }

    const data = {
        kind: formData.get('kind'),
        model: formData.get('model'),
        amd_price: parseFloat(formData.get('amd_price') || 0),  // Ensure to parse as float
        ram_size: parseFloat(formData.get('ram_size')),
        os: formData.get('os'),
        storage: storage,
        is_laptop: formData.get('is_laptop') === 'yes',
        battery_capacity: parseFloat(formData.get('battery_capacity') || 0),
        has_large_screen: formData.get('has_large_screen') === 'yes',
        has_touch_screen: formData.get('has_touch_screen') === 'yes',
        desktop_wifi: formData.get('desktop_wifi') === 'yes',
        wifi_kind: formData.get('wifi_kind') || '',
        has_gpu: formData.get('has_gpu') === 'yes',
        gpu_type: formData.get('gpu_type') || '',
        passmark_score: parseFloat(formData.get('passmark_score') || 0),  // Ensure to parse as float
        custom_build: formData.get('custom_build') === 'yes'
    };

    const response = await fetch('/calculate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });

    const result = await response.json();
    document.getElementById('result').innerHTML = `
        <h4>Results:</h4>
        <p>Processor Price: $${result.processor_price}</p>
        <p>RAM Price: $${result.ram_price}</p>
        <p>Storage Price: $${result.storage_price}</p>
        <p>OS Price: $${result.os_price}</p>
        <p>GPU Price: $${result.gpu_price}</p>
        <h3>Total Price: $${result.total_price}</h3>
    `;
});


        function addStorage() {
            const container = document.getElementById('storage-container');
            if (container.querySelectorAll('.storage-item').length >= 4) return;

            const storageItem = document.createElement('div');
            storageItem.className = 'form-group storage-item';
            storageItem.innerHTML = `
                <label>Storage Device</label>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" name="storage_size" placeholder="e.g., 500 GB or 2 TB" required>
                    <select class="form-control" name="storage_kind" required>
                        <option value="HDD">HDD</option>
                        <option value="SATA">SATA</option>
                        <option value="NvME">NvME</option>
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-danger" type="button" onclick="removeStorage(this)">Remove</button>
                    </div>
                </div>
            `;
            container.appendChild(storageItem);
        }

        function removeStorage(button) {
            button.closest('.storage-item').remove();
        }

        function toggleProcessorOptions() {
            const kind = document.getElementById('kind').value;
            const amdPriceContainer = document.getElementById('amd-price-container');
            
            if (kind.toLowerCase() === 'amd') {
                amdPriceContainer.style.display = '';
            } else {
                amdPriceContainer.style.display = 'none';
            }
        }

        function toggleLaptopOptions() {
            const isLaptop = document.getElementById('is_laptop').value === 'yes';
            document.getElementById('laptop-options').style.display = isLaptop ? '' : 'none';
            document.getElementById('desktop-options').style.display = isLaptop ? 'none' : '';
        }

        function toggleWifiOptions() {
            const hasWifi = document.getElementById('desktop_wifi').value === 'yes';
            document.getElementById('wifi-kind-container').style.display = hasWifi ? '' : 'none';
        }

        function toggleGpuOptions() {
            const hasGpu = document.getElementById('has_gpu').value === 'yes';
            document.getElementById('gpu-options').style.display = hasGpu ? '' : 'none';
        }
    </script>
</body>
</html>
